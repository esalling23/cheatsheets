<div class="post-module--content-padding--9Yweb"><h1>Using setTimeout in React components (including hooks)</h1><div class="post-module--post-meta--2SNYO"><div class="post-tag-container"><a style="text-decoration: none; margin-right: 5px;" href="/tags/react/"><button type="button" alt="" class="button-module--button--75DNA    ">react</button></a></div></div><div class="post-module--social--1915-"><a href="https://twitter.com/intent/tweet?text=Using setTimeout in React components (including hooks)&amp;url=https://felixgerschau.com/react-hooks-settimeout/&amp;hastags=react&amp;via=4xfelix" data-size="large" target="_blank" rel="noopener noreferrer"><button type="button" alt="" class="button-module--button--75DNA tweet-module--tweet--3rk4-   ">Tweet</button></a><button type="button" alt="" class="button-module--button--75DNA copyLink-module--button--3vm_l    ">Copy link</button></div><div id="mobile-carbon-script"></div><p>Using the <code class="language-text">setTimeout</code> function works the same in React as it does in plain JavaScript.</p><p>However, there are some caveats that you need to be aware of when using it in React that I want to get into in this tutorial.</p><p>Stick around for the last section, where we'll look at a better way of handling timeouts with React hooks.</p><div class="toc"><ul><li><a href="#how-to-use-settimeout-in-react">How to use setTimeout in React</a></li><li><a href="#using-state-in-settimeout">Using state in setTimeout</a></li><li><a href="#declarative-timeouts-with-the-usetimeout-hook">Declarative timeouts with the useTimeout hook</a></li><li><a href="#conclusion">Conclusion</a></li></ul></div><h2 id="how-to-use-settimeout-in-react" style="position: relative;"><a href="#how-to-use-settimeout-in-react" aria-label="how to use settimeout in react permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to use setTimeout in React</h2><p>The <code class="language-text">setTimeout</code> function accepts two arguments: the first is the callback function that we want to execute, and the second specifies the timeout in milliseconds before the function will be called.</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Initial timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>In React, we use it the same way. Be careful, though, not to just place it anywhere in your function components, as this may run on every re-render.</p><p>If we want to execute the timeout <strong>once</strong> when the component mounts, we need to use <code class="language-text">useEffect</code> for that:</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Initial timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><div class="caption"><p>The example can be found in this <a href="https://codepen.io/fgerschau/pen/mdwOjXb?editors=0011" target="_blank" rel="nofollow noopener noreferrer">Codepen</a>.</p></div><p>This already leads us to the next important part: <strong>always clear the timeout</strong>.</p><h3 id="always-clear-the-timeout" style="position: relative;"><a href="#always-clear-the-timeout" aria-label="always clear the timeout permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Always clear the timeout</h3><p>If we don't clear our timeouts when the component unmounts, the code in the callback may execute even when the component isn't visible anymore.</p><p>It can also lead to <strong>memory leaks</strong> in your application. Since the timeout is still active after the component unmounts, the garbage collector won't collect the component.</p><blockquote><p>Read my article on <a href="/javascript-memory-management/">JavaScript's memory management</a> if you want to know how this works in detail.</p></blockquote><p>Error messages like this one will pop up in the console:</p><p><span style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px;" class="gatsby-resp-image-wrapper">
      <span style="padding-bottom: 12%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhElEQVQI1y2IWw6CMADAwA2jAQU8h/wxBmyTCAhofPDh/a9SA/GjaVNv0Ds+TnCvNrydZG4C5kvAy0q+1y1PI+kLwU2L1Z0SDKVgLAW9lgx1yGQjWr0nP/t4eeYzmYiHCxnNga5OaauE3qS0dUKjE+o8xqoEs/Bvp0+rrTpii+XFqEzyAxwsPIVBvsq+AAAAAElFTkSuQmCC'); background-size: cover; display: block;" class="gatsby-resp-image-background-image"></span>
  <img alt="Can't call &quot;this.setState&quot; on an unmounted component." title="Can't call &quot;this.setState&quot; on an unmounted component." src="/static/55732e070bb36ed8b4bb93eb23edaa67/5a190/react-async-noop.png" srcset="/static/55732e070bb36ed8b4bb93eb23edaa67/772e8/react-async-noop.png 200w,/static/55732e070bb36ed8b4bb93eb23edaa67/e17e5/react-async-noop.png 400w,/static/55732e070bb36ed8b4bb93eb23edaa67/5a190/react-async-noop.png 800w,/static/55732e070bb36ed8b4bb93eb23edaa67/c1b63/react-async-noop.png 1200w,/static/55732e070bb36ed8b4bb93eb23edaa67/0e904/react-async-noop.png 1384w" sizes="(max-width: 800px) 100vw, 800px" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0;" loading="lazy" decoding="async" class="gatsby-resp-image-image">
    </span></p><div class="caption"><p>Can't call "this.setState" on an unmounted component.</p></div><p>To clear a timeout, we need to call <code class="language-text">clearTimeout</code> with the returned value of <code class="language-text">setTimeout</code>:</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Initial timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><h4 id="function-components" style="position: relative;"><a href="#function-components" aria-label="function components permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Function components</h4><p>We can use the <code class="language-text">useEffect</code> for running code when the component unmounts as well.</p><p>We can return a function in the callback that will run when the component unmounts. We'll use this function to clear the timeout we created on mount.</p><div data-language="javascript" class="gatsby-highlight has-highlighted-lines"><pre class="language-javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Initial timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>But what if we want to create a timeout <em>outside</em> of <code class="language-text">useEffect</code>?</p><p>Doing the following <strong>doesn't</strong> work because <code class="language-text">timer</code> will be redefined on every re-render:</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> timer<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hey ??'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// "timer" will be undefined again after the next re-render</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><div class="caption"><p>This doesn't work.</p></div><p>Using React's state for this also doesn't make sense because it would trigger a re-render. We need someplace where the variable will persist without using state.</p><p>References do exactly that.</p><p>We can assign the timer to <code class="language-text">timerRef.current</code> and access it when the component unmounts:</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> timerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  timerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hey ??'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Clear the interval when the component unmounts</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timerRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>We can be sure that the timeout function will only execute if the component is mounted.</p><blockquote><p>You can try out the examples in this <a href="https://codepen.io/fgerschau/pen/mdwOjXb?editors=0011" target="_blank" rel="nofollow noopener noreferrer">Codepen</a>. Try to click  "Hide App component" immediately <strong>after</strong> "Send message". If it weren't for calling <code class="language-text">clearTimeout</code>, you would still see the alert.</p></blockquote><h4 id="class-components" style="position: relative;"><a href="#class-components" aria-label="class components permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Class components</h4><p>Persisting state between re-renders is much easier in class components. Here, we can create a new class property for the timer.</p><p>Then we clear the timeout in the lifecycle function <code class="language-text">componentWillUnmount</code>:</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  timer<span class="token punctuation">;</span>

  <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hey ??'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>sendMessage<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Send message
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h2 id="using-state-in-settimeout" style="position: relative;"><a href="#using-state-in-settimeout" aria-label="using state in settimeout permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using state in setTimeout</h2><p>Using state variables in the <code class="language-text">setTimeout</code> callback can be a bit counterintuitive.</p><p>Let's take the following code as an example. You can type a message in the input field; clicking "Send message" displays an alert after two seconds.</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>sendMessage<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Send message
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>If you change the input value immediately <strong>after</strong> you click "Send message", <em>will the timeout display the updated value, or will it take the last value that was available when you clicked the button?</em></p><blockquote><p>You can try it out <a href="https://codepen.io/fgerschau/pen/OJgpdZv" target="_blank" rel="nofollow noopener noreferrer">here</a>.</p></blockquote><p>As stated in this <a href="https://github.com/facebook/react/issues/14010" target="_blank" rel="nofollow noopener noreferrer">GitHub issue</a>, <code class="language-text">setTimeout</code> will use the value that it was <strong>initially</strong> called with. In our example, this also makes sense as you wouldn't want to send another message other than the one that was displayed when you clicked the button.</p><p>If we want to get the <strong>most recent value</strong>, we need to make use of references.</p><p>We first create a new reference with the <code class="language-text">useRef</code> hook and then use <code class="language-text">useEffect</code> to listen to changes of the <code class="language-text">message</code> variable.</p><p>Every time the variable changes, we'll assign the reference to the value of the state.</p><p>We'll then use the reference instead of the state variable in the timeout to get the latest version.</p><div data-language="javascript" class="gatsby-highlight has-highlighted-lines"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> messageRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    messageRef<span class="token punctuation">.</span>current <span class="token operator">=</span> message<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Most recent value</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span>messageRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>sendMessage<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Send message
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div><h2 id="declarative-timeouts-with-the-usetimeout-hook" style="position: relative;"><a href="#declarative-timeouts-with-the-usetimeout-hook" aria-label="declarative timeouts with the usetimeout hook permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Declarative timeouts with the useTimeout hook</h2><p>Similar to the <a href="https://overreacted.io/making-setinterval-declarative-with-react-hooks/" target="_blank" rel="nofollow noopener noreferrer">useInterval</a> hook, creating a custom <code class="language-text">useTimeout</code> hook makes working with timeouts in React easier.</p><p>Abstracting away the creation and clearing of timeouts makes using them more manageable and safer since we don't have to remember clearing them every time.</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token function">useTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>Just like <code class="language-text">setTimeout</code>, the hook accepts a callback and a number.</p><p>Setting the number to <code class="language-text">null</code> will disable the timeout, and it also automatically cancels it when the component unmounts.</p><p>The code of the hook looks like the following.</p><div data-language="javascript" class="gatsby-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">useTimeout</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> savedCallback <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

  <span class="token comment">// Remember the latest callback if it changes.</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    savedCallback<span class="token punctuation">.</span>current <span class="token operator">=</span> callback
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// Set up the timeout.</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Don't schedule if no delay is specified.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> savedCallback<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div><div class="caption"><p>Props to the <a href="https://usehooks-typescript.com/react-hook/use-timeout" target="_blank" rel="nofollow noopener noreferrer">useHooks website</a> for providing the code for this hook.</p></div><p>Note how the hook clears the timeout in the returned callback function of the <code class="language-text">useEffect</code> hook. This will make sure that it always clears when <code class="language-text">delay</code> changes or when the component unmounts.</p><p>On the <a href="https://overreacted.io/making-setinterval-declarative-with-react-hooks/" target="_blank" rel="nofollow noopener noreferrer">Overreacted blog</a>, Dan Abramov explains in detail why this approach integrates so well with how we write React code.</p><h2 id="conclusion" style="position: relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2><p>As you can see in this article, you need to be aware of several things when using timeouts in React.</p><p>Still, you can get around most of the issues by using the <code class="language-text">useInterval</code> hook instead of using the JavaScript API every time as it handles clearing the timeout for you.</p><p>If this article helped you, sign up for my newsletter to get notified when I publish new articles about <a href="/tags/react/">React</a> and <a href="/tags/javascript/">JavaScript</a>.</p><p>Examples used in this tutorial:</p><ul><li><a href="https://codepen.io/fgerschau/pen/mdwOjXb?editors=0011" target="_blank" rel="nofollow noopener noreferrer">setTimeout example (Codepen)</a></li><li><a href="https://codepen.io/fgerschau/pen/OJgpdZv?editors=0010" target="_blank" rel="nofollow noopener noreferrer">Using setTimeout with state (Codepen)</a></li><li><a href="https://usehooks-typescript.com/react-hook/use-timeout" target="_blank" rel="nofollow noopener noreferrer">The useTimeout hook (usehooks-typescript.com)</a></li></ul><p>Other articles you might like:</p><ul><li><p><a href="/react-hooks-separation-of-concerns/">Separation of concerns with React hooks</a></p><p>Learn how you can use React hooks to organize your code.</p></li><li><p><a href="/react-rerender-components/">When does React re-render components?</a></p><p>In this article, I explain in detail everything you need to know about rendering in React.</p></li></ul><div style="text-align: center;" class="Position-module--jobs-wrapper--3i9Kf Position-module--hide-desktop--2mR7Y"><h3>Remote Jobs</h3><div class="Position-module--global-positions-wrapper--3MT0e"><div class="Position-module--position-wrapper--1919q"><a href="https://bit.ly/3IUKkrM" target="_blank" rel="noopener"><h6 class="Position-module--company--28q0E">Nebulab</h6><h5>Senior React Engineer</h5><p>🌎 Worldwide 💰 $60 - $180k</p></a></div><a href="/jobs/"><h5>More positions</h5></a></div></div></div>